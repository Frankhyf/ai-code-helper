# åç«¯ Long ç±»å‹é…ç½®ä¿®æ­£è¯´æ˜

## å½“å‰é…ç½®é—®é¢˜

æ‚¨çš„é…ç½®ä»£ç ï¼š

```java
@JsonComponent
public class JsonConfig {
    @Bean
    public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) {
        ObjectMapper objectMapper = builder.createXmlMapper(false).build();
        SimpleModule module = new SimpleModule();
        module.addSerializer(Long.class, ToStringSerializer.instance);
        module.addSerializer(Long.TYPE, ToStringSerializer.instance);
        objectMapper.registerModule(module);
        return objectMapper;
    }
}
```

**é—®é¢˜ï¼š** `@JsonComponent` å’Œ `@Bean` ä¸åº”è¯¥åŒæ—¶ä½¿ç”¨ï¼Œå¯èƒ½å¯¼è‡´é…ç½®ä¸ç”Ÿæ•ˆã€‚

---

## âœ… æ¨èçš„ä¿®æ­£æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨ Configurationï¼ˆæ¨èï¼‰

**ä¿®æ”¹ä¸ºï¼š**

```java
package com.frank.aicodehelper.config;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.module.SimpleModule;
import com.fasterxml.jackson.databind.ser.std.ToStringSerializer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;
import org.springframework.http.converter.json.Jackson2ObjectMapperBuilder;

/**
 * Jackson é…ç½® - è§£å†³å‰ç«¯å¤§æ•´æ•°ç²¾åº¦ä¸¢å¤±
 */
@Configuration
public class JacksonConfig {

    @Bean
    @Primary
    public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) {
        ObjectMapper objectMapper = builder.createXmlMapper(false).build();
        
        // é…ç½® Long ç±»å‹åºåˆ—åŒ–ä¸º String
        SimpleModule module = new SimpleModule();
        module.addSerializer(Long.class, ToStringSerializer.instance);
        module.addSerializer(Long.TYPE, ToStringSerializer.instance);
        
        objectMapper.registerModule(module);
        return objectMapper;
    }
}
```

**å…³é”®ä¿®æ”¹ï¼š**
1. âœ… å°† `@JsonComponent` æ”¹ä¸º `@Configuration`
2. âœ… æ·»åŠ  `@Primary` æ³¨è§£ï¼ˆç¡®ä¿ä¼˜å…ˆä½¿ç”¨è¿™ä¸ª ObjectMapperï¼‰
3. âœ… ç±»åæ”¹ä¸º `JacksonConfig`ï¼ˆæ›´æ¸…æ™°ï¼‰

---

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨ Jackson2ObjectMapperBuilderCustomizerï¼ˆæ›´ç®€æ´ï¼‰

**æˆ–è€…ä½¿ç”¨è¿™ä¸ªæ›´ç®€æ´çš„æ–¹æ¡ˆï¼š**

```java
package com.frank.aicodehelper.config;

import com.fasterxml.jackson.databind.ser.std.ToStringSerializer;
import org.springframework.boot.autoconfigure.jackson.Jackson2ObjectMapperBuilderCustomizer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * Jackson é…ç½® - è§£å†³å‰ç«¯å¤§æ•´æ•°ç²¾åº¦ä¸¢å¤±
 */
@Configuration
public class JacksonConfig {
    
    @Bean
    public Jackson2ObjectMapperBuilderCustomizer jackson2ObjectMapperBuilderCustomizer() {
        return builder -> {
            // Long ç±»å‹åºåˆ—åŒ–ä¸º Stringï¼Œé¿å…å‰ç«¯ç²¾åº¦ä¸¢å¤±
            builder.serializerByType(Long.class, ToStringSerializer.instance);
            builder.serializerByType(Long.TYPE, ToStringSerializer.instance);
        };
    }
}
```

**è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼š**
- âœ… ä»£ç æ›´ç®€æ´
- âœ… ä¸éœ€è¦ `@Primary`
- âœ… è‡ªåŠ¨é›†æˆåˆ° Spring Boot çš„é»˜è®¤é…ç½®

---

## ğŸ” éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

### æ­¥éª¤1ï¼šä¿®æ”¹é…ç½®å¹¶é‡å¯åç«¯

1. é€‰æ‹©ä¸Šé¢ä»»ä¸€æ–¹æ¡ˆæ›¿æ¢æ‚¨çš„ `JsonConfig.java`
2. é‡å¯åç«¯æœåŠ¡

### æ­¥éª¤2ï¼šæµ‹è¯•APIè¿”å›æ ¼å¼

**æ–¹æ³•Aï¼šä½¿ç”¨æµè§ˆå™¨æµ‹è¯•**

åœ¨å‰ç«¯é¡¹ç›®çš„æµ‹è¯•é¡µé¢ï¼ˆ`test-api.html`ï¼‰ä¸­æµ‹è¯•ç™»å½•åï¼Œåœ¨Consoleæ‰§è¡Œï¼š

```javascript
fetch('/api/app/add', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  credentials: 'include',
  body: JSON.stringify({initPrompt: 'æµ‹è¯•'})
})
.then(r => r.text())
.then(text => {
  console.log('åŸå§‹å“åº”:', text);
  const data = JSON.parse(text);
  console.log('data.data ç±»å‹:', typeof data.data);
  console.log('data.data å€¼:', data.data);
});
```

**é¢„æœŸè¾“å‡ºï¼š**
```
åŸå§‹å“åº”: {"code":200,"data":"345570418158932752","message":"ok"}
data.data ç±»å‹: string
data.data å€¼: 345570418158932752
```

**æ–¹æ³•Bï¼šä½¿ç”¨ Postman æµ‹è¯•**

1. POST `http://localhost:8123/api/app/add`
2. Headers: `Content-Type: application/json`
3. Body: `{"initPrompt":"æµ‹è¯•"}`
4. æŸ¥çœ‹å“åº”ä¸­ `data` å­—æ®µæ˜¯å¦ä¸ºå­—ç¬¦ä¸²æ ¼å¼

**æ–¹æ³•Cï¼šæŸ¥çœ‹åç«¯æ—¥å¿—**

åœ¨ Controller æ·»åŠ æ—¥å¿—ï¼š

```java
@PostMapping("/add")
public BaseResponse<Long> addApp(@RequestBody AppAddRequest appAddRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(appAddRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    Long appId = appService.createApp(appAddRequest, loginUser);
    
    // æ·»åŠ æ—¥å¿—æŸ¥çœ‹è¿”å›å€¼
    System.out.println("åˆ›å»ºåº”ç”¨æˆåŠŸï¼ŒappId = " + appId);
    System.out.println("appId ç±»å‹: " + appId.getClass().getName());
    
    return ResultUtils.success(appId);
}
```

---

## ğŸ¯ å‰ç«¯å…¼å®¹æ€§ç¡®è®¤

å‰ç«¯ä»£ç å·²ç»å…¼å®¹å­—ç¬¦ä¸²å’Œæ•°å­—ä¸¤ç§æ ¼å¼ï¼š

```typescript
// app.ts - createApp()
let appId: number
if (typeof response === 'number') {
  appId = response
} else if (typeof response === 'string') {
  appId = parseInt(response, 10)  // âœ… å­—ç¬¦ä¸²è½¬æ•°å­—
}
```

æ‰€ä»¥åç«¯é…ç½®ç”Ÿæ•ˆåï¼Œå‰ç«¯ä¼šè‡ªåŠ¨å…¼å®¹ã€‚

---

## ğŸ› å¦‚æœé…ç½®è¿˜æ˜¯ä¸ç”Ÿæ•ˆ

### æ£€æŸ¥1ï¼šæ˜¯å¦æœ‰å¤šä¸ª ObjectMapper Bean

å¦‚æœé¡¹ç›®ä¸­æœ‰å¤šä¸ª ObjectMapper çš„é…ç½®ï¼Œå¯èƒ½ä¼šå†²çªã€‚

**è§£å†³æ–¹æ³•ï¼š**
- ç¡®ä¿åªæœ‰ä¸€ä¸ª Jackson é…ç½®ç±»
- æˆ–åœ¨æ‚¨çš„é…ç½®ä¸Šæ·»åŠ  `@Primary` æ³¨è§£

### æ£€æŸ¥2ï¼šæ˜¯å¦æœ‰å…¶ä»–åºåˆ—åŒ–é…ç½®

æ£€æŸ¥ `application.yml` æˆ– `application.properties`ï¼š

```yaml
# ä¸è¦æœ‰è¿™æ ·çš„é…ç½®
spring:
  jackson:
    serialization:
      WRITE_NUMBERS_AS_STRINGS: false  # â† åˆ é™¤æˆ–æ”¹ä¸º true
```

### æ£€æŸ¥3ï¼šç¡®è®¤ Jackson ç‰ˆæœ¬

ç¡®ä¿ä½¿ç”¨çš„æ˜¯ Jackson 2.x ç‰ˆæœ¬ï¼Œåœ¨ `pom.xml` ä¸­ï¼š

```xml
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.15.0</version>  <!-- æˆ–æ›´é«˜ç‰ˆæœ¬ -->
</dependency>
```

---

## ğŸ“ å®Œæ•´çš„é…ç½®æ£€æŸ¥æ¸…å•

- [ ] å°† `@JsonComponent` æ”¹ä¸º `@Configuration`
- [ ] æ·»åŠ  `@Primary` æ³¨è§£ï¼ˆå¦‚ä½¿ç”¨æ–¹æ¡ˆ1ï¼‰
- [ ] é‡å¯åç«¯æœåŠ¡
- [ ] æµ‹è¯•APIè¿”å›æ ¼å¼ï¼ˆåº”ä¸ºå­—ç¬¦ä¸²ï¼‰
- [ ] å‰ç«¯é‡æ–°æµ‹è¯•åˆ›å»ºåº”ç”¨
- [ ] éªŒè¯åº”ç”¨è¯¦æƒ…èƒ½å¦æ­£ç¡®è·å–

---

## âœ¨ ä¿®æ”¹åçš„é¢„æœŸæ•ˆæœ

**åç«¯å“åº”ï¼š**
```json
{
  "code": 200,
  "data": "345570418158932752",
  "message": "ok"
}
```

**å‰ç«¯æ§åˆ¶å°ï¼š**
```
APIå“åº”: /api/app/add {code: 200, data: "345570418158932752", message: "ok"}
åˆ›å»ºåº”ç”¨å“åº”: 345570418158932752 ç±»å‹: string
åº”ç”¨åˆ›å»ºæˆåŠŸ
Chaté¡µé¢ - è·¯ç”±å‚æ•°ID: 345570418158932752 è½¬æ¢åID: 345570418158932752
æ­£åœ¨è·å–åº”ç”¨è¯¦æƒ…ï¼ŒID: 345570418158932752
åº”ç”¨è¯¦æƒ…è·å–æˆåŠŸ: {...}
```

**ä¸å†å‡ºç°ï¼š**
- âŒ `345570418158932000`ï¼ˆç²¾åº¦ä¸¢å¤±ï¼‰
- âŒ `è¯·æ±‚æ•°æ®ä¸å­˜åœ¨`ï¼ˆIDé”™è¯¯ï¼‰

---

## ğŸš€ æ¨èæ“ä½œ

1. **ç«‹å³ä¿®æ”¹é…ç½®**ï¼šä½¿ç”¨æ–¹æ¡ˆ2ï¼ˆæ›´ç®€æ´ï¼‰
2. **é‡å¯åç«¯æœåŠ¡**
3. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°å‰ç«¯**
4. **é‡æ–°æµ‹è¯•åˆ›å»ºåº”ç”¨**

ä¿®æ”¹ååº”è¯¥å°±èƒ½å®Œå…¨æ­£å¸¸å·¥ä½œäº†ï¼

